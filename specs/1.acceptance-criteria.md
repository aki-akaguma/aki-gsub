# Acceptance Criteria for aki-gsub (EARS Format)

This document specifies the acceptance criteria for the `aki-gsub` utility using the Easy Approach to Requirements Syntax (EARS).

### Ubiquitous Requirements (Always Active)

- **UC1:** The `aki-gsub` system shall perform text substitution on a standard input stream using one or more regular expressions.
- **UC2:** The `aki-gsub` system shall write all output to the standard output stream.
- **UC3:** The `aki-gsub` system shall replace capture group references (e.g., `$1`, `$2`) in the format string with the corresponding text captured by the associated expression.
- **UC4:** The `aki-gsub` system shall apply all specified expression/format pairs to each line of input.
- **UC5:** The `aki-gsub` system shall apply substitutions based on the match's starting position in the original line.

### Event-Driven Requirements (Triggered by an Event)

- **EV1:** When the `--help` or `-H` flag is provided, the `aki-gsub` system shall display a help message and exit successfully.
- **EV2:** When the `--version` or `-V` flag is provided, the `aki-gsub` system shall display version information and exit successfully.

### Conditional Requirements (Optional Features)

- **OP1:** Where the `--color` option is set to `'always'`, the `aki-gsub` system shall highlight matched text using ANSI color codes.
- **OP2:** Where the `--color` option is set to `'auto'`, the `aki-gsub` system shall highlight matched text if and only if standard output is a terminal (TTY).
- **OP3:** Where the `--quiet` or `-n` flag is specified, the `aki-gsub` system shall only print lines that contain a successful substitution.
- **OP4:** Where the `AKI_GSUB_COLOR_SEQ_ST` environment variable is set, the `aki-gsub` system shall use its value as the starting ANSI escape code for highlighting.
- **OP5:** Where the `AKI_GSUB_COLOR_SEQ_ED` environment variable is set, the `aki-gsub` system shall use its value as the ending ANSI escape code for highlighting.

### Unwanted Behavior (Error Handling)

- **ER1:** If a line of input does not contain a match, then the `aki-gsub` system shall print the original line to standard output, unless the `--quiet` flag is active.
- **ER2:** If the number of `--exp` arguments does not match the number of `--format` arguments, then the `aki-gsub` system shall report an error and exit with a non-zero status code.
- **ER3:** If an invalid command-line argument is provided, then the `aki-gsub` system shall report an error, print a help hint, and exit with a non-zero status code.
- **ER4:** If a broken pipe error occurs during output, then the `aki-gsub` system shall exit gracefully with a zero status code.
