# Development Tasks for aki-gsub

This document lists the development tasks derived from the design document. Since the project is already implemented, all tasks are marked as complete.

### Executable & Library Structure

- [x] **`main.rs`**: Create the executable entry point.
- [x] **`main.rs`**: Initialize I/O streams and environment.
- [x] **`main.rs`**: Call the core library function and manage the final exit code.
- [x] **`lib.rs`**: Establish a library crate for core functionality.
- [x] **`lib.rs`**: Define a public `execute` function to orchestrate the application flow.

### Configuration (`conf/` module)

- [x] **`conf/parse.rs`**: Implement command-line argument parsing using the `flood-tide` crate.
- [x] **`conf/cmd.match.rs.txt`**: Define the command-line option specifications.
- [x] **`conf/cmd.help.rs.txt`**: Define the help text for command-line options.
- [x] **`conf/mod.rs`**: Define the `CmdOptConf` struct to hold parsed command-line arguments.
- [x] **`conf/mod.rs`**: Define the `EnvConf` struct to hold settings from environment variables.
- [x] **`conf/parse.rs`**: Implement validation for required arguments (e.g., paired `-e`/`-f`).
- [x] **`conf/parse.rs`**: Implement logic to handle `--help` and `--version` flags.
- [x] **`conf/parse.rs`**: Implement the `auto` logic for the `--color` option by checking if stdout is a TTY.

### Core Substitution Logic (`run.rs`)

- [x] **`run.rs`**: Compile string patterns from `CmdOptConf` into `regex::Regex` objects.
- [x] **`run.rs`**: Read input line-by-line from the provided input stream.
- [x] **`run.rs`**: For each line, find all non-overlapping matches for all configured regexes.
- [x] **`run.rs`**: Implement a `ReplacedOut` data structure to hold match position and formatted text.
- [x] **`run.rs`**: Sort all found matches by their starting position to ensure correct replacement order.
- [x] **`run.rs`**: Reconstruct the output line from original substrings and formatted replacements.
- [x] **`run.rs`**: Implement `--quiet` flag logic to suppress output for non-matching lines.
- [x] **`run.rs`**: Implement `--color` flag logic to wrap substitutions with ANSI color codes.
- [x] **`run.rs`**: Write the final, processed line to the provided output stream.

### Utilities (`util/` module)

- [x] **`util/err.rs`**: Implement the `BrokenPipeError` trait and associated logic to handle `SIGPIPE` gracefully.
- [x] **`util/opt_color_when.rs`**: Create the `OptColorWhen` enum (`Always`, `Never`, `Auto`) with its `FromStr` implementation.
- [x] **`util/opt_uc_x_param.rs`**: Create the `OptUcXParam` enum and parser for extensible `-X` options.
